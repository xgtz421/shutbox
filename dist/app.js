var createError=require("http-errors"),express=require("express"),path=require("path"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),logger=require("morgan"),session=require("express-session"),indexRouter=require("./routes/index"),usersRouter=require("./routes/users"),registerRouter=require("./routes/register"),loginRouter=require("./routes/login"),entriesRouter=require("./routes/entries"),messages=require("./lib/messages"),user=require("./middleware/user"),validate=require("./lib/middleware/validate"),page=require("./lib/middleware/page"),Entry=require("./lib/entry"),api=require("./routes/api"),app=express();app.set("views",path.join(__dirname,"views")),app.set("view engine","ejs"),app.use(logger("dev")),app.use(bodyParser.urlencoded({extended:!0})),app.use(express.json()),app.use(express.urlencoded({extended:!1})),app.use(cookieParser("my shut box")),app.use(session()),app.use(express.static(path.join(__dirname,"public"))),app.use("/api",api.auth),app.use(user),app.use(messages),app.use("/users",usersRouter),app.get("/register",registerRouter.form),app.post("/register",registerRouter.submit),app.get("/login",loginRouter.form),app.post("/login",loginRouter.submit),app.get("/logout",loginRouter.logout),app.get("/post",entriesRouter.form),app.post("/post",validate.required("title"),validate.lengthAbove("title",4),entriesRouter.submit),app.get("/:page?",page(Entry.count,5),entriesRouter.list),app.get("/api/user/:id",api.user),app.post("/api/entry",entriesRouter.submit),app.get("/api/entries/:page?",page(Entry.count),api.entries),app.use(function(e,r,s){s(createError(404))}),app.use(function(e,r,s,p){s.locals.message=e.message,s.locals.error="development"===r.app.get("env")?e:{},s.status(e.status||500),s.render("error")}),module.exports=app;